{% extends 'blank.html' %}


{% block content %}
    <div id="container" style="min-width:400px;height:400px"></div>
    <div class="message"></div>
{% endblock %}



{% block extra_js %}
<script type="text/javascript" src="/static/js/highcharts/highcharts.js"></script>
<script type="text/javascript" src="/static/js/highcharts/data.js"></script>
<script type="text/javascript">
    {# CUSTOMER_ID的来龙去脉：父页面中a标签被点击后触发onclick事件，事件进行了以下操作#}
    {# 1、获取a标签包含的客户号 #}
    {# 2、启动路由规则"viewCustomerContributionHistory"，并指定在newWindow中显示路由结果（也就是这个页面） #}
    {# 3、在第二步进行的同时，父页面给newWindow（本页面）开辟了全局变量CUSTOMER_ID并赋值 #}
    $(function(){
        document.head.getElementsByTagName('title')[0].innerText = window.CUSTOMER_NAME;
        drawCustomerDepositHistory('container', {customer_id: window.CUSTOMER_ID});
    });

    function drawCustomerDepositHistory(divId, postDataDict){
        let chart;
        $.post(
            {
                url: '{% url "viewCustomerContributionHistory" %}',
                {#async: false,#}
                data: postDataDict,
                dataType: 'json',
                success: function(data, textStatus, $XHR){
                    chart = Highcharts.chart(divId, {
                        data: {
                            csv: data
                        },
                        title: {
                            text: window.CUSTOMER_NAME + '存款余额走势'
                        },
                        subtitle: {
                            text: ''
                        },
                        xAxis: {
                            tickInterval: 7 * 24 * 3600 * 1000, // 坐标轴刻度间隔为7天
                            tickWidth: 0,
                            gridLineWidth: 1,
                            labels: {
                                align: 'left',
                                x: 3,
                                y: 20
                            },
                            // 时间格式化字符
                            // 默认会根据当前的刻度间隔取对应的值，即当刻度间隔为一周时，取 week 值
                            dateTimeLabelFormats: {
                                week: '%Y-%m-%d'
                            }
                        },
                        yAxis: [{ // 第一个 Y 轴，放置在左边（默认在坐标）
                            title: {
                                text: null
                            },
                            labels: {
                                align: 'left',
                                x: 3,
                                y: 16,
                                format: '{value:.,0f}'
                            },
                            showFirstLabel: false
                        }, {    // 第二个坐标轴，放置在右边
                            linkedTo: 0,
                            gridLineWidth: 0,
                            opposite: true,  // 通过此参数设置坐标轴显示在对立面
                            title: {
                                text: null
                            },
                            labels: {
                                align: 'right',
                                x: -3,
                                y: 16,
                                format: '{value:.,0f}'
                            },
                            showFirstLabel: false
                        }],
                        legend: {
                            align: 'left',
                            verticalAlign: 'top',
                            y: 20,
                            floating: true,
                            borderWidth: 0
                        },
                        tooltip: {
                            shared: true,
                            crosshairs: true,
                            // 时间格式化字符
                            // 默认会根据当前的数据点间隔取对应的值
                            // 当前图表中数据点间隔为 1天，所以配置 day 值即可
                            dateTimeLabelFormats: {
                                day: '%Y-%m-%d'
                            }
                        },
                        plotOptions: {
                            series: {
                                //cursor: 'pointer',
                                point: {
                                    events: {
                                        // 数据点点击事件
                                        // 其中 e 变量为事件对象，this 为当前数据点对象
                                        click: function (e) {
                                            //$('.message').html( Highcharts.dateFormat('%Y-%m-%d', this.x) + ':<br/>  访问量：' +this.y );
                                            console.log(e);
                                        }
                                    }
                                },
                                marker: {
                                    lineWidth: 1
                                }
                            }
                        }
                    });


                },
                error: function(){alert('error')}
            }
        );
    }
</script>

{% endblock %}