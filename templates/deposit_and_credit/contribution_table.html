{% extends 'blank.html' %}

{% block extra_css %}
<link href="/static/assets/plugins/css-chart/css-chart.css" rel="stylesheet">
{% endblock %}


{% block content %}

{% endblock %}


{% block extra_js %}
<script type="text/javascript" src="/static/myjs/common.js"></script>
<script type="text/javascript" src="/static/js/highcharts.js"></script>
<script type="text/javascript" src="/static/myjs/contribution_table.js"></script>
<script type="text/javascript">

    function viewCustomerContributionHistory(elem){
        let newWindow = window.open('{% url "viewCustomerContributionHistory" %}');
        newWindow.CUSTOMER_ID = elem.getAttribute('customer_id');
        newWindow.CUSTOMER_NAME = elem.innerText;
    }

    function viewSeriesContribution(elem){
        let customer_trs = elem.nextSibling.getElementsByTagName('tbody')[0].getElementsByTagName('tr'),
            customer_ids = [];
        for(let i=0;i<customer_trs.length;i++){
            let customer_td = customer_trs[i].children[0];
            customer_ids.push(customer_td.getElementsByTagName('a')[0].getAttribute('customer_id'));
        }
        let dept_series = elem.nextSibling.getElementsByTagName('thead')[1].children[0].children[0].innerText.replace('汇总', '');
        let newWindow = window.open('{% url "viewSeriesContributionHistory" %}');
        newWindow.CUSTOMER_IDS = customer_ids;
        newWindow.SERIES_CODE = elem.getAttribute('series_code');
        newWindow.SERIES_CAPTION = elem.innerText;
        newWindow.DEPT_SERIES = dept_series;
    }

    function viewDeptContributionHistory(elem){
        let newWindow = window.open('{% url "viewDepartmentContributionHistory" %}');
        newWindow.DEPT_CODE = elem.getAttribute('dept_code');
    }

    $(function () {
        let filter_condict = OPENER_PARAMS,
            ordered_dept = getDeptOrder();
        buildContribTable(filter_condict, ordered_dept);
    });

</script>

{% endblock %}